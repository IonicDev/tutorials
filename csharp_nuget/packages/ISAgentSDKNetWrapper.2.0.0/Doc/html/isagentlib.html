<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<meta name="generator" content="Doxygen 1.8.18" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="Description" content="Client SDK Version 2.0.0: Ionic Security client SDK for C# users" />
<meta name="keywords" content="AgentKeyServices Implementors Overview" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::CreateKey()" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::CreateKeys()" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::GetKeyspace()" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::Initialize()" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::Initialize(AgentConfig^)" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::Initialize(AgentConfig^, DeviceProfilePersistor ^)" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::Initialize(DeviceProfilePersistor ^)" />
<meta name="keywords" content="IonicSecurity::SDK::Agent::UpdateProfileFromKNS()" />
<meta name="keywords" content="IonicSecurity::SDK::DeviceProfilePersistor" />
<meta name="keywords" content="IonicSecurity::SDK::DeviceProfilePersistor::LoadAllProfiles()" />
<meta name="keywords" content="IonicSecurity::SDK::DeviceProfilePersistor::SaveAllProfiles()" />
<title>Client SDK Version 2.0.0: Agent Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link href="ISAgentSDK.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Client SDK Version 2.0.0
   </div>
   <div id="projectbrief">Ionic Security client SDK for C# users</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Agent Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#agentlib-introduction">Introduction to Agent</a></li>
<li class="level1"><a href="#agentlib-thread">Thread Safety</a></li>
<li class="level1"><a href="#agentlib-keyservices">Using AgentKeyServices</a></li>
<li class="level1"><a href="#agentlib-config">Initializing Agent</a></li>
<li class="level1"><a href="#agentlib-kns">KNS (Keyspace Name Service) features in SDK</a></li>
<li class="level1"><a href="#agentlib-persistorimpl">Custom Device Profile Persistor Implementation</a></li>
<li class="level1"><a href="#agentlib-createkeys">Creating Keys</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="agentlib-introduction"></a>
Introduction to Agent</h1>
<p>Agent is the client-side library for all Ionic.com API endpoint communication.</p>
<p><br />
</p>
<h1><a class="anchor" id="agentlib-thread"></a>
Thread Safety</h1>
<p>Agent is not thread-safe. All classes in the Agent module are not thread-safe and should not be used as a shared resource between concurrent threads. In order to use objects in a multi-threaded environment, it is recommended to create one object per thread.</p>
<p><br />
</p>
<h1><a class="anchor" id="agentlib-keyservices"></a>
Using AgentKeyServices</h1>
<p>Agent provides a default implementation of AgentKeyServices interface. It is possible for a user to override that interface and provide their own backend solution for key services (for example Offline Key Vault), that can be used by the ciphers for encryption and decryption. <br />
Please see the <a class="el" href="isagentkeyservices.html">AgentKeyServices Implementors Overview</a>.</p>
<p><br />
</p>
<h1><a class="anchor" id="agentlib-config"></a>
Initializing Agent</h1>
<p>Before you can begin using an Agent object, it must first be initialized. The initialization process performs device profile loading and other non-trivial internal resource initialization to prepare it for secure communication with Ionic API servers.</p>
<p>Initializing an Agent object can be done a few different ways. If all configuration defaults are ok (which is typical) then you can simply call <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#a3b0697077cf3a85d5d8e7822dfb03419">IonicSecurity::SDK::Agent::Initialize()</a>.</p>
<p><b>Simplest Example:</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an agent and initialize it using all defaults</span></div>
<div class="line">Agent agent = <span class="keyword">new</span> Agent();</div>
<div class="line">agent.Initialize();</div>
</div><!-- fragment --><p>If you need to provide some custom configuration, then you can create a configuration object and pass it to the <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#af8efe8ca8c76c2eadbd0f6a06cceae1f">IonicSecurity::SDK::Agent::Initialize(AgentConfig^)</a> function.</p>
<p><b>Custom Configuration Example:</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an agent configuration object</span></div>
<div class="line">AgentConfig config = <span class="keyword">new</span> AgentConfig();</div>
<div class="line">config.UserAgent = <span class="stringliteral">"My Application Name"</span>;</div>
<div class="line">config.MaxRedirects = 2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// initialize the agent from our config object</span></div>
<div class="line">Agent agent = <span class="keyword">new</span> Agent();</div>
<div class="line">agent.Initialize(config);</div>
</div><!-- fragment --><p><br />
If you need to provide a custom device profile persistor to load device profiles using a custom implementation, then you can create it and pass it to the <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#a9c2a5a99188cce43806913ee4ee3db7e">IonicSecurity::SDK::Agent::Initialize(DeviceProfilePersistor ^)</a> or <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#a25c361383de657d95dadda40473633fd">IonicSecurity::SDK::Agent::Initialize(AgentConfig^, DeviceProfilePersistor ^)</a> functions.</p>
<p><b>Custom Configuration with Custom Device Profile Persistor:</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an agent configuration object</span></div>
<div class="line">AgentConfig config = <span class="keyword">new</span> AgentConfig();</div>
<div class="line">config.UserAgent = <span class="stringliteral">"My Application Name"</span>;</div>
<div class="line">config.MaxRedirects = 2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create your custom device profile persistor (example can be found in</span></div>
<div class="line"><span class="comment">// Custom Device Profile Persistor Implementation section below).</span></div>
<div class="line"><span class="comment">// configure it as needed with any options it may support.</span></div>
<div class="line">MyCustomProfilePersistor profilePersistor = <span class="keyword">new</span> MyCustomProfilePersistor();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// initialize the agent from the config object and persistor object.  the</span></div>
<div class="line"><span class="comment">// persistor is used to automatically load device profiles.</span></div>
<div class="line">Agent agent = <span class="keyword">new</span> Agent();</div>
<div class="line">agent.Initialize(config, profilePersistor);</div>
</div><!-- fragment --><p><br />
</p>
<h1><a class="anchor" id="agentlib-kns"></a>
KNS (Keyspace Name Service) features in SDK</h1>
<p>The KNS features allow users to query information about a particular keyspace. Using the <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#a8bd6a9fefd9ed4dfe2d97a6e9269ceb5">IonicSecurity::SDK::Agent::GetKeyspace()</a> function users can get the tenant ID, the fully qualified domain name, the API URL and finally the enrollment URL. SDK clients (like the Machina CLI) can use this query during enrollment to get the enrollment URL. While enrollment will set up the initial API URL, a user can still use the KNS query to make sure the keyspace API URL hasn't moved. Finally, SDK includes a convenience function for updating a particular device profile, <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#ac8dc22faadae6493e0a8eed6bcd04b39">IonicSecurity::SDK::Agent::UpdateProfileFromKNS()</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an agent and initialize it using all defaults</span></div>
<div class="line">Agent agent = <span class="keyword">new</span> Agent();</div>
<div class="line">agent.Initialize();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update the active profile from the default Ionic KNS provider.</span></div>
<div class="line">agent.updateProfileFromKNS(<span class="stringliteral">""</span>, <span class="stringliteral">""</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ----- OR -----</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Iterate over the list, and update each profile, from a non-default KNS server</span></div>
<div class="line">profiles = agent.AllProfiles;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; profiles.Count; ++i)</div>
<div class="line">{</div>
<div class="line">  DeviceProfile profile = profiles[i];</div>
<div class="line">  agent.UpdateProfileFromKNS(profile.DeviceId, <span class="stringliteral">"www.myknsserver.com"</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Finally, persist any changes</span></div>
<div class="line">DeviceProfilePersistorWindows persistor = <span class="keyword">new</span> DeviceProfilePersistorWindows();</div>
<div class="line">agent.SaveProfiles(persistor);</div>
</div><!-- fragment --><p><br />
</p>
<h1><a class="anchor" id="agentlib-persistorimpl"></a>
Custom Device Profile Persistor Implementation</h1>
<p>It is possible to provide a custom device profile persistor implementation to an Agent instance, if needed. The default implementation for each supported platform is typically sufficient. <br />
<br />
The device profile persistor is responsible for securely storing device profile information. A device profile stores, among other things, shared secrets (cryptographic keys) issued to a device during registration / enrollment. For every succesful registration that is performed, a device profile is created and stored. <br />
<br />
To provide a custom device profile persistor implementation to an Agent instance, you first need to define your persistor class as sub-class of <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_device_profile_persistor.html">IonicSecurity::SDK::DeviceProfilePersistor</a>. Doing this enforces that you implement the <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_device_profile_persistor.html">IonicSecurity::SDK::DeviceProfilePersistor</a> interface. <br />
<br />
The Agent object initialized with a persistor will call that module's loadAllProfiles() function upon initialization. <br />
 If this function throws an exception, Agent will log that error. <br />
<br />
You may call Agent::saveProfiles(persistor), which in turn calls the module's saveAllProfiles() function. <br />
<br />
You may call Agent::loadProfiles(persistor), which in turn calls the module's loadAllProfiles() function. <br />
<br />
There are only two virtual functions to implement, which are <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_device_profile_persistor.html#a3b2d93be46b195a998663aa638d2d3a7">IonicSecurity::SDK::DeviceProfilePersistor::LoadAllProfiles()</a> and <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_device_profile_persistor.html#a148c3e03cde2e2dc0f4af8693b2fc9de">IonicSecurity::SDK::DeviceProfilePersistor::SaveAllProfiles()</a>. These functions are responsible for loading and saving a vector of device profile objects as well as the currently active device profile ID (if any). <br />
<br />
Below is an example of a custom <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_device_profile_persistor.html" title="Interface class for all device profile persistor implementations.">IonicSecurity::SDK::DeviceProfilePersistor</a> implementation skeleton.</p>
<p><b>Example custom DeviceProfilePersistor class (C# source file):</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyCustomDeviceProfilePersistor : DeviceProfilePersistor</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// implement the profile load function</span></div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> LoadAllProfiles(ref List&lt; DeviceProfile &gt; lstProfilesOut, ref String msActiveProfileIdOut)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// your code here!</span></div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// implement the profile save function</span></div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> SaveAllProfiles(List&lt; DeviceProfile &gt; lstProfiles, String msActiveProfileId)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// your code here!</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example usage of custom AgentDeviceProfilePersistor class (C++ main program file):</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// this will initialize an agent and automatically load device profiles using</span></div>
<div class="line"><span class="comment">// your custom device profile persistor</span></div>
<div class="line">MyCustomDeviceProfilePersistor profilePersistor = <span class="keyword">new</span> MyCustomDeviceProfilePersistor();</div>
<div class="line">Agent agent = <span class="keyword">new</span> Agent();</div>
<div class="line">agent.Initialize(profilePersistor);</div>
</div><!-- fragment --><p><br />
</p>
<h1><a class="anchor" id="agentlib-createkeys"></a>
Creating Keys</h1>
<p>In order to protect sensitive data, keys must be requested from Agent using <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#a955666c4d5b23623d136a41e8dd28d82">IonicSecurity::SDK::Agent::CreateKey()</a> or <a class="el" href="class_ionic_security_1_1_s_d_k_1_1_agent.html#aad9decb5ea35de5eb103c591b060dbac" title="Creates protection keys through Ionic.com.">IonicSecurity::SDK::Agent::CreateKeys()</a> along with optional MetadataMap and AttributesMap objects to hold information about the application and data being secured.</p>
<p><b>Example of creating a single key:</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set up our desired key attributes for the key</span></div>
<div class="line">CreateKeysRequest.Key requestKey = <span class="keyword">new</span> CreateKeysRequest.Key(<span class="stringliteral">"refid_test"</span>);</div>
<div class="line">requestKey.Attributes.Add(<span class="stringliteral">"confidential"</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">requestKey.Attributes[<span class="stringliteral">"confidential"</span>].Add(<span class="stringliteral">"admins"</span>);</div>
<div class="line">requestKey.Attributes[<span class="stringliteral">"confidential"</span>].Add(<span class="stringliteral">"mods"</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// add key object to a request</span></div>
<div class="line">CreateKeysRequest request = <span class="keyword">new</span> CreateKeysRequest();</div>
<div class="line">request.Keys.Add(requestKey);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// execute the create key request</span></div>
<div class="line">CreateKeysResponse response = agent.CreateKeys(request);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// your resulting key object is the first object in the response keys array</span></div>
<div class="line">  <span class="comment">// and is guaranteed to exist</span></div>
<div class="line">CreateKeysResponse.Key responseKey = response.Keys[0];</div>
</div><!-- fragment --><p><b>Example of creating multiple keys:</b> </p><div class="fragment"><div class="line"><span class="keyword">using</span> IonicSecurity.SDK;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// set up a key request object that will create five keys, each one having</span></div>
<div class="line"><span class="comment">// key attributes that indicate they will be protecting a social security number</span></div>
<div class="line">CreateKeysRequest.Key requestKey = <span class="keyword">new</span> CreateKeysRequest.Key(<span class="stringliteral">"refid_ssn"</span>);</div>
<div class="line">requestKey.Attributes.Add(<span class="stringliteral">"contains"</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">requestKey.Attributes[<span class="stringliteral">"contains"</span>].Add(<span class="stringliteral">"ssn"</span>);</div>
<div class="line">requestKey.Quantity = 5;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// set up a key request object that will create three keys, each one having</span></div>
<div class="line"><span class="comment">// key attributes that indicate they will be protecting credit card data</span></div>
<div class="line">CreateKeysRequest.Key requestKeyCred = <span class="keyword">new</span> CreateKeysRequest.Key(<span class="stringliteral">"refid_credit"</span>);</div>
<div class="line">requestKeyCred.Attributes.Add(<span class="stringliteral">"contains"</span>, <span class="keyword">new</span> List&lt;string&gt;());</div>
<div class="line">requestKeyCred.Attributes[<span class="stringliteral">"contains"</span>].Add(<span class="stringliteral">"financial"</span>);</div>
<div class="line">requestKeyCred.Attributes[<span class="stringliteral">"contains"</span>].Add(<span class="stringliteral">"creditcard"</span>);</div>
<div class="line">requestKeyCred.Quantity = 3;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// set up the batch key creation request using the key objects we defined above</span></div>
<div class="line">CreateKeysRequest request = <span class="keyword">new</span> CreateKeysRequest();</div>
<div class="line">request.Keys.Add(requestKey);</div>
<div class="line">request.Keys.Add(requestKeyCred);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// execute the create key request</span></div>
<div class="line">CreateKeysResponse response = agent.CreateKeys(request);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// at this point, any keys that were successfully created are available in the</span></div>
<div class="line"><span class="comment">// response object. there is no guarantee that ANY keys were created, which</span></div>
<div class="line"><span class="comment">// is where the "refId" (reference ID) field of the key request comes in. we</span></div>
<div class="line"><span class="comment">// need to iterate over all the response keys and determine which type each one</span></div>
<div class="line"><span class="comment">// is.  there will be anywhere between zero and eight keys in this response.</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer" /><address class="footer">
<p class="small">You acknowledge your access, review and use of the documentation on this page is subject to the Ionic Security Inc. <a href="https://dev.ionic.com/use.html">Documentation Use Rights</a>.</p>
<p class="small">&copy; 2016-2020 Ionic Security Inc. All rights reserved.&#160;-&#160;
Generated on Thu Jul 2 2020 12:23:19 for Client SDK Version 2.0.0 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen" />
</a> 1.8.18 </p>
</address>

</body>
</html>
